<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Web App</title>

    <!-- Google Fonts: Inter & Roboto Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet">

    <!-- Google Material Symbols -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <style>
        :root {
            --bg-primary: #17181a;
            --bg-secondary: #202225;
            --bg-tertiary: #2c2f33;
            --bg-code: #101214;
            --bg-hover: #35383c;
            --text-primary: #f0f2f5;
            --text-secondary: #a8b3cf;
            --text-active: #82aaff;
            --border-color: #3a3d42;
            --sidebar-width: 260px;
            --font-family: 'Inter', sans-serif;
            --font-family-code: 'Roboto Mono', monospace;
        }

        /* --- Base & Reset --- */
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        html, body { height: 100%; overflow: hidden; background-color: var(--bg-primary); color: var(--text-primary); font-family: var(--font-family); font-size: 16px; }
        button, a { background: none; border: none; cursor: pointer; color: inherit; text-decoration: none; font-family: inherit; }
        .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 300, 'GRAD' 0, 'opsz' 24; font-size: 20px; color: var(--text-secondary); transition: color 0.2s; user-select: none; }

        /* --- Accessibility --- */
        .visually-hidden { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }
        *:focus-visible { outline: 2px solid var(--text-active); outline-offset: 2px; border-radius: 4px; }

        /* --- Main Layout --- */
        .app-container { display: flex; width: 100%; height: 100%; }
        .main-wrapper { width: 100%; height: 100%; display: flex; flex-direction: column; }
        .main-header { display: flex; align-items: center; padding: 12px 24px; background-color: rgba(23, 24, 26, 0.7); backdrop-filter: blur(12px); border-bottom: 1px solid var(--border-color); flex-shrink: 0; position: sticky; top: 0; z-index: 100; }
        .header-title { font-size: 1.1rem; font-weight: 600; }
        .icon-button { padding: 8px; border-radius: 50%; display: flex; transition: background-color 0.2s; }
        .icon-button:hover { background-color: var(--bg-hover); }
        .content-area { flex-grow: 1; overflow: hidden; position: relative; }
        
        /* --- Sidebar --- */
        #left-sidebar { position: fixed; top: 0; left: 0; height: 100%; width: var(--sidebar-width); max-width: 85%; background-color: var(--bg-secondary); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; z-index: 1001; transform: translateX(-100%); transition: transform 0.3s ease-in-out; }
        body.left-sidebar-open #left-sidebar { transform: translateX(0); }
        .sidebar-content { padding: 16px; display: flex; flex-direction: column; flex-grow: 1; overflow-y: auto; }
        .sidebar-header { font-size: 1.75rem; font-weight: 700; padding: 12px; margin-bottom: 24px; }
        .sidebar-nav a, .sidebar-nav button { font-size: 1em; display: flex; align-items: center; gap: 16px; padding: 12px; border-radius: 8px; font-weight: 500; transition: background-color 0.2s, color 0.2s, opacity 0.2s; color: var(--text-secondary); text-align: left; width: 100%; }
        .sidebar-nav a:hover, .sidebar-nav button:hover { background-color: var(--bg-hover); color: var(--text-primary); }
        .sidebar-nav a.active { background-color: var(--bg-tertiary); color: var(--text-primary); }
        .sidebar-nav .material-symbols-outlined { color: var(--text-secondary); }
        .sidebar-nav a:hover .material-symbols-outlined, .sidebar-nav a.active .material-symbols-outlined, .sidebar-nav button:hover .material-symbols-outlined { color: var(--text-primary); }
        .sidebar-footer { margin-top: auto; padding-top: 16px; border-top: 1px solid var(--border-color); }
        
        /* --- Screen Layout --- */
        .screen { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .screen.active { display: block; }
        #home-screen, #history-screen, #profile-screen { overflow-y: auto; padding: 16px 8px; }
        .content-wrapper { max-width: 820px; width: 100%; margin: 0 auto; padding: 16px 0; }
        .page-header { margin-bottom: 24px; padding: 0 16px;}
        .page-header h2 { font-size: 1.75rem; }

        /* --- Home Screen --- */
        .home-header { text-align: center; margin-bottom: 40px; padding: 0 16px; }
        .home-header h1 { font-size: 2.5rem; margin-bottom: 8px; }
        .home-header p { font-size: 1.1rem; color: var(--text-secondary); }
        .suggestion-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px; padding: 0 16px; }
        .suggestion-card { display: block; background-color: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; transition: background-color 0.2s, border-color 0.2s; }
        body:not(.touch-device) .suggestion-card:hover { background-color: var(--bg-tertiary); border-color: #4f5257; }
        .suggestion-card .material-symbols-outlined { margin-bottom: 12px; color: var(--text-secondary); }
        .suggestion-card h3 { font-size: 1.1rem; font-weight: 600; margin-bottom: 8px; color: var(--text-primary); }
        .suggestion-card p { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; }

        /* --- Chat Screen --- */
        #chat-screen.active { display: flex; flex-direction: column; position: relative; }
        .chat-container { flex-grow: 1; overflow-y: auto; padding: 16px 8px; scroll-behavior: smooth; }
        .chat-content-wrapper { display: flex; flex-direction: column; gap: 32px; max-width: 820px; width: 100%; margin: 0 auto; padding: 16px; }
        .chat-message { position: relative; background-color: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 16px 20px; display: flex; flex-direction: column; gap: 12px; }
        .message-header { display: flex; justify-content: space-between; align-items: center; }
        .message-role { font-weight: 700; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px; }
        .user-message { border-left: 3px solid var(--user-accent-color, #82aaff); }
        .user-message .message-role { color: var(--user-accent-color, #82aaff); }
        .ai-message { border-left: 3px solid var(--model-accent-color, #c792ea); }
        .ai-message .message-role { color: var(--model-accent-color, #c792ea); }
        .message-body { line-height: 1.7; font-size: 1rem; color: var(--text-primary); word-wrap: break-word; }
        .message-body > *:first-child { margin-top: 0; }
        .message-body > *:last-child { margin-bottom: 0; }
        .message-body p { margin-bottom: 1em; }
        .message-body pre { background-color: var(--bg-code); padding: 16px; border-radius: 8px; overflow-x: auto; font-family: var(--font-family-code); font-size: 0.9em; white-space: pre-wrap; }
        .message-body code { font-family: var(--font-family-code); background-color: var(--bg-code); padding: 0.2em 0.4em; border-radius: 4px; }
        .message-body pre code { background-color: transparent; padding: 0; }
        .message-body ul, .message-body ol { padding-left: 20px; }
        .message-body li { margin-bottom: 0.5em; }

        .chat-footer { flex-shrink: 0; padding: 16px 24px; border-top: 1px solid var(--border-color); background: var(--bg-primary); }
        .prompt-input-wrapper { position: relative; width: 100%; max-width: 820px; margin: 0 auto; display: flex; align-items: flex-end; gap: 12px; background-color: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 8px 12px; transition: border-color 0.2s; }
        .prompt-input-wrapper:focus-within { border-color: var(--text-active); }
        .prompt-input { width: 100%; background: transparent; border: none; color: var(--text-primary); outline: none; font-size: 1rem; line-height: 1.6; resize: none; max-height: 200px; }
        .send-button { background-color: var(--bg-tertiary); width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; align-self: flex-end; transition: background-color 0.2s ease, transform 0.2s ease, opacity 0.2s; transform: scale(0.9); opacity: 0.6; }
        .send-button.active { background-color: var(--text-active); transform: scale(1); opacity: 1; }
        .send-button:disabled { background-color: var(--bg-tertiary); cursor: not-allowed; opacity: 0.5; transform: scale(0.9); }
        .send-button.active .material-symbols-outlined { color: var(--bg-primary); }
        
        .typing-indicator { display: flex; align-items: center; gap: 8px; background-color: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 16px 20px; color: var(--text-secondary); font-style: italic; font-size: 0.9rem; }
        .typing-indicator .dot { width: 8px; height: 8px; background-color: var(--text-secondary); border-radius: 50%; animation: typing-bounce 1.2s infinite ease-in-out; }
        .typing-indicator .dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator .dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing-bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
        
        .scroll-to-bottom-btn { position: absolute; bottom: 110px; left: 50%; transform: translateX(-50%) translateY(20px); background-color: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 20px; padding: 8px 16px; font-size: 0.9rem; font-weight: 500; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 10; opacity: 0; visibility: hidden; transition: opacity 0.3s, transform 0.3s, visibility 0.3s; }
        .scroll-to-bottom-btn.visible { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }

        /* --- Profile Screen & Form Group --- */
        .profile-card { background-color: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 24px; margin-bottom: 24px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-size: 0.9rem; font-weight: 500; color: var(--text-secondary); margin-bottom: 8px; }
        .form-group input { width: 100%; background-color: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 6px; padding: 12px; font-size: 1rem; color: var(--text-primary); outline: none; transition: border-color 0.2s; }
        .form-group input:focus { border-color: var(--text-active); }
        .form-group input:disabled { background-color: var(--bg-primary); opacity: 0.7; cursor: not-allowed; }
        .profile-actions { display: flex; justify-content: flex-end; gap: 12px; }
        .btn { padding: 10px 20px; font-weight: 600; border-radius: 8px; transition: background-color 0.2s, color 0.2s; }
        .btn-primary { background-color: var(--text-active); color: var(--bg-primary); }
        .btn-primary:hover { opacity: 0.9; }
        .btn-secondary { background: none; border: 1px solid var(--border-color); color: var(--text-primary); }
        .btn-secondary:hover { background-color: var(--bg-hover); }

        /* --- Modal Component --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; z-index: 2000; }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content { background-color: var(--bg-secondary); padding: 24px; border-radius: 12px; border: 1px solid var(--border-color); width: 90%; max-width: 500px; transform: scale(0.95); transition: transform 0.3s; }
        .modal-overlay.visible .modal-content { transform: scale(1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .modal-header h2 { font-size: 1.25rem; font-weight: 600; }
        .modal-body p { color: var(--text-secondary); margin-bottom: 16px; line-height: 1.6; }

        /* --- Auth Modal --- */
        .auth-view { display: none; }
        .auth-view.active { display: block; }
        .auth-footer-text { margin-top: 24px; text-align: center; font-size: 0.9rem; color: var(--text-secondary); }
        .auth-footer-text a { color: var(--text-active); font-weight: 500; }
        .auth-footer-text a:hover { text-decoration: underline; }
        .form-group-inline { display: flex; justify-content: flex-end; margin-bottom: 24px; }
        .form-group-inline a { font-size: 0.9rem; color: var(--text-active); }
        .form-group-inline a:hover { text-decoration: underline; }
        .auth-divider { display: flex; align-items: center; text-align: center; color: var(--text-secondary); font-size: 0.8rem; margin: 24px 0; }
        .auth-divider::before, .auth-divider::after { content: ''; flex: 1; border-bottom: 1px solid var(--border-color); }
        .auth-divider:not(:empty)::before { margin-right: .5em; }
        .auth-divider:not(:empty)::after { margin-left: .5em; }
        .btn-google { width: 100%; display: flex; justify-content: center; align-items: center; gap: 12px; }
        .btn-google svg { width: 18px; height: 18px; flex-shrink: 0; }

        /* --- Responsive & Overlay --- */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; z-index: 1000; }
        body.left-sidebar-open .overlay { opacity: 1; visibility: visible; }
        @media (min-width: 1024px) {
            #left-sidebar { position: static; transform: none; }
            .icon-button#menu-toggle { display: none; }
        }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="overlay" id="overlay"></div>

        <!-- Sidebar -->
        <aside id="left-sidebar">
            <div class="sidebar-content">
                <div class="sidebar-header">Gemini</div>
                <nav class="sidebar-nav">
                    <a href="#" class="nav-link active" data-screen="home-screen"><span class="material-symbols-outlined" aria-hidden="true">home</span><span>Home</span></a>
                    <a href="#" class="nav-link" data-screen="chat-screen"><span class="material-symbols-outlined" aria-hidden="true">chat</span><span>New Chat</span></a>
                    <a href="#" class="nav-link" data-screen="history-screen"><span class="material-symbols-outlined" aria-hidden="true">history</span><span>History</span></a>
                </nav>
                <div class="sidebar-footer">
                    <nav class="sidebar-nav" id="sidebar-footer-auth" style="display: none;">
                        <a href="#" class="nav-link" data-screen="profile-screen"><span class="material-symbols-outlined" aria-hidden="true">account_circle</span><span>Profile</span></a>
                    </nav>
                    <nav class="sidebar-nav" id="sidebar-footer-guest">
                        <button id="login-signup-btn"><span class="material-symbols-outlined" aria-hidden="true">login</span><span>Login / Sign Up</span></button>
                    </nav>
                </div>
            </div>
        </aside>

        <!-- Main Content Wrapper -->
        <main class="main-wrapper">
             <header class="main-header">
                <button class="icon-button" id="menu-toggle" aria-label="Open menu"><span class="material-symbols-outlined" aria-hidden="true">menu</span></button>
                <h1 class="header-title" id="header-title" aria-live="polite">Home</h1>
            </header>

            <div class="content-area" id="content-area" role="main" aria-label="Main content: Home screen">
                <!-- Home Screen -->
                <div id="home-screen" class="screen active">
                    <div class="content-wrapper">
                        <header class="home-header">
                            <h1>Welcome to Gemini</h1>
                            <p>Your versatile AI assistant. How can I help you today?</p>
                        </header>
                        <div class="suggestion-grid">
                            <a href="#" class="suggestion-card" data-prompt="Draft an email to a client about a project update, keeping the tone professional and concise."><span class="material-symbols-outlined" aria-hidden="true">edit_note</span><h3>Draft an email</h3><p>To a client about a project update, keeping the tone professional and concise.</p></a>
                            <a href="#" class="suggestion-card" data-prompt="Explain the concept of 'hoisting' in JavaScript with a simple code example."><span class="material-symbols-outlined" aria-hidden="true">code</span><h3>Explain a concept</h3><p>Explain the concept of 'hoisting' in JavaScript with a simple code example.</p></a>
                            <a href="#" class="suggestion-card" data-prompt="Create a 5-day itinerary for a cultural trip to Kyoto, Japan, for two people."><span class="material-symbols-outlined" aria-hidden="true">flight</span><h3>Plan a trip</h3><p>Create a 5-day itinerary for a cultural trip to Kyoto, Japan, for two people.</p></a>
                            <a href="#" class="suggestion-card" data-prompt="Brainstorm ideas for a new mobile app that helps users learn a new skill in 15 minutes a day."><span class="material-symbols-outlined" aria-hidden="true">lightbulb</span><h3>Brainstorm ideas</h3><p>For a new mobile app that helps users learn a new skill in 15 minutes a day.</p></a>
                        </div>
                    </div>
                </div>

                <!-- Chat Screen -->
                <div id="chat-screen" class="screen">
                    <div class="chat-container" id="chat-container">
                        <div class="content-wrapper chat-content-wrapper" id="chat-content-wrapper">
                            <!-- Chat messages will be injected here -->
                        </div>
                    </div>
                     <button id="scroll-to-bottom-btn" class="scroll-to-bottom-btn">
                        â†“ New Message
                    </button>
                    <footer class="chat-footer">
                        <form class="prompt-input-wrapper" id="chat-form">
                            <textarea class="prompt-input" id="message-input" placeholder="Enter a prompt here..." rows="1" aria-label="Chat message"></textarea>
                            <button type="submit" class="send-button" id="send-button" aria-label="Send message"><span class="material-symbols-outlined" aria-hidden="true">arrow_upward</span></button>
                        </form>
                    </footer>
                </div>

                <!-- History Screen -->
                <div id="history-screen" class="screen">
                    <div class="content-wrapper">
                        <header class="page-header">
                            <h2>Conversation History</h2>
                        </header>
                        <p style="padding: 0 16px; color: var(--text-secondary);">Saving chat history to your account is coming soon!</p>
                    </div>
                </div>

                <!-- Profile Screen -->
                <div id="profile-screen" class="screen">
                    <div class="content-wrapper">
                        <header class="page-header">
                            <h2>Profile Settings</h2>
                        </header>
                        <form id="profile-form">
                            <section class="profile-card" aria-labelledby="user-info-heading">
                                <h3 id="user-info-heading" class="visually-hidden">User Information</h3>
                                <div class="form-group">
                                    <label for="full-name">Full Name</label>
                                    <input type="text" id="full-name" required>
                                </div>
                                <div class="form-group">
                                    <label for="email">Email Address</label>
                                    <input type="email" id="email" required disabled>
                                </div>
                            </section>
                            <div class="profile-actions">
                                 <button type="button" class="btn btn-secondary" id="logout-btn">Log Out</button>
                                 <button type="submit" class="btn btn-primary">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal-overlay">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="auth-modal-title">
            <header class="modal-header">
                <h2 id="auth-modal-title">Login</h2>
                <button class="icon-button modal-close-btn" aria-label="Close modal"><span class="material-symbols-outlined" aria-hidden="true">close</span></button>
            </header>
            <div class="modal-body">
                <!-- Login View -->
                <div id="login-view" class="auth-view active">
                    <form id="login-form">
                        <div class="form-group">
                            <label for="login-email">Email Address</label>
                            <input type="email" id="login-email" required autocomplete="email">
                        </div>
                        <div class="form-group">
                            <label for="login-password">Password</label>
                            <input type="password" id="login-password" required autocomplete="current-password">
                        </div>
                        <div class="form-group-inline">
                            <a href="#" class="auth-view-switch" data-target-view="forgot-password-view">Forgot password?</a>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                    </form>
                    <div class="auth-divider"><span>OR</span></div>
                    <button class="btn btn-secondary btn-google">
                        <svg aria-hidden="true" width="18" height="18" viewBox="0 0 18 18"><path d="M17.64 9.20455C17.64 8.56682 17.5827 7.95273 17.4764 7.36364H9V10.845H13.8436C13.635 11.97 13.0009 12.9232 12.0477 13.6127V15.8195H14.9564C16.6582 14.2527 17.64 11.9455 17.64 9.20455Z" fill="#4285F4"></path><path d="M9 18C11.43 18 13.4673 17.1941 14.9564 15.8195L12.0477 13.6127C11.2418 14.1014 10.2109 14.4205 9 14.4205C6.65591 14.4205 4.67182 12.8373 3.96409 10.71H0.957275V13.0073C2.43818 15.9873 5.48182 18 9 18Z" fill="#34A853"></path><path d="M3.96409 10.71C3.78409 10.1718 3.68182 9.59318 3.68182 9C3.68182 8.40682 3.78409 7.82818 3.96409 7.29H0.957275V9.58727C0.347727 7.96273 0.347727 6.03727 0.957275 4.41273V2.11545L3.96409 4.29C4.67182 2.16273 6.65591 0.579545 9 0.579545C10.3214 0.579545 11.5077 1.02136 12.4232 1.82182L15.0218 0H14.9564C13.4673 0.805909 11.43 0 9 0C5.48182 0 2.43818 2.01273 0.957275 4.99273C0.347727 6.61727 0.347727 8.38273 0.957275 10.0073V12.3045L3.96409 10.71Z" fill="#FBBC05"></path><path d="M9 3.57955C10.3214 3.57955 11.5077 4.02136 12.4232 4.82182L15.0218 2.18045C13.4673 0.819545 11.43 0 9 0C5.48182 0 2.43818 2.01273 0.957275 4.99273V7.29H3.96409C4.67182 5.16273 6.65591 3.57955 9 3.57955Z" fill="#EA4335"></path></svg>
                        <span>Continue with Google</span>
                    </button>
                    <p class="auth-footer-text">
                        Don't have an account? <a href="#" class="auth-view-switch" data-target-view="signup-view">Sign Up</a>
                    </p>
                </div>

                <!-- Sign Up View -->
                <div id="signup-view" class="auth-view">
                    <form id="signup-form">
                         <div class="form-group">
                            <label for="signup-name">Full Name</label>
                            <input type="text" id="signup-name" required autocomplete="name">
                        </div>
                        <div class="form-group">
                            <label for="signup-email">Email Address</label>
                            <input type="email" id="signup-email" required autocomplete="email">
                        </div>
                        <div class="form-group">
                            <label for="signup-password">Password</label>
                            <input type="password" id="signup-password" required autocomplete="new-password">
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 16px;">Create Account</button>
                    </form>
                    <div class="auth-divider"><span>OR</span></div>
                     <button class="btn btn-secondary btn-google">
                        <svg aria-hidden="true" width="18" height="18" viewBox="0 0 18 18"><path d="M17.64 9.20455C17.64 8.56682 17.5827 7.95273 17.4764 7.36364H9V10.845H13.8436C13.635 11.97 13.0009 12.9232 12.0477 13.6127V15.8195H14.9564C16.6582 14.2527 17.64 11.9455 17.64 9.20455Z" fill="#4285F4"></path><path d="M9 18C11.43 18 13.4673 17.1941 14.9564 15.8195L12.0477 13.6127C11.2418 14.1014 10.2109 14.4205 9 14.4205C6.65591 14.4205 4.67182 12.8373 3.96409 10.71H0.957275V13.0073C2.43818 15.9873 5.48182 18 9 18Z" fill="#34A853"></path><path d="M3.96409 10.71C3.78409 10.1718 3.68182 9.59318 3.68182 9C3.68182 8.40682 3.78409 7.82818 3.96409 7.29H0.957275V9.58727C0.347727 7.96273 0.347727 6.03727 0.957275 4.41273V2.11545L3.96409 4.29C4.67182 2.16273 6.65591 0.579545 9 0.579545C10.3214 0.579545 11.5077 1.02136 12.4232 1.82182L15.0218 0H14.9564C13.4673 0.805909 11.43 0 9 0C5.48182 0 2.43818 2.01273 0.957275 4.99273C0.347727 6.61727 0.347727 8.38273 0.957275 10.0073V12.3045L3.96409 10.71Z" fill="#FBBC05"></path><path d="M9 3.57955C10.3214 3.57955 11.5077 4.02136 12.4232 4.82182L15.0218 2.18045C13.4673 0.819545 11.43 0 9 0C5.48182 0 2.43818 2.01273 0.957275 4.99273V7.29H3.96409C4.67182 5.16273 6.65591 3.57955 9 3.57955Z" fill="#EA4335"></path></svg>
                        <span>Continue with Google</span>
                    </button>
                    <p class="auth-footer-text">
                        Already have an account? <a href="#" class="auth-view-switch" data-target-view="login-view">Login</a>
                    </p>
                </div>

                <!-- Forgot Password View -->
                <div id="forgot-password-view" class="auth-view">
                    <form id="forgot-password-form">
                        <p style="margin-bottom: 24px; color: var(--text-secondary);">Enter your email and we'll send you a link to reset your password.</p>
                        <div class="form-group">
                            <label for="forgot-email">Email Address</label>
                            <input type="email" id="forgot-email" required autocomplete="email">
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 16px;">Send Reset Link</button>
                    </form>
                    <p class="auth-footer-text">
                        <a href="#" class="auth-view-switch" data-target-view="login-view">Back to Login</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <!-- Showdown.js for Markdown to HTML conversion -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>

    <script type="module">
        // --- Gemini API SDK ---
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyD4otYB2NTMERgK9fw5NVKyXUH9fU2j018",
            authDomain: "instaaic.firebaseapp.com",
            databaseURL: "https://instaaic-default-rtdb.firebaseio.com",
            projectId: "instaaic",
            storageBucket: "instaaic.appspot.com",
            messagingSenderId: "168344843231",
            appId: "1:168344843231:web:6a215780e0b42b8c000a6a",
            measurementId: "G-NEVQTX1P56"
        };
        
        // --- Gemini API Key ---
        // SECURITY WARNING: Do not expose your API key in client-side code in a real application.
        const GEMINI_API_KEY = "AIzaSyCgcGrSbAcfNhgsZB-MfI_B6cm_KIn41R8";

        // --- Initialize Firebase, Gemini, and Markdown Converter ---
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        const genAI = new GoogleGenerativeAI(GEMINI_API_KEY);
        const model = genAI.getGenerativeModel({ model: "gemini-pro" });
        const markdownConverter = new showdown.Converter();
        
        let chat; // Holds the state of the current conversation

        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE ---
            let lastActiveElement;
            let isUserScrolledUp = false;

            // --- DOM Elements ---
            const body = document.body;
            const menuToggle = document.getElementById('menu-toggle');
            const overlay = document.getElementById('overlay');
            const navLinks = document.querySelectorAll('.nav-link');
            const screens = document.querySelectorAll('.screen');
            const headerTitle = document.getElementById('header-title');
            const contentArea = document.getElementById('content-area');
            const chatContainer = document.getElementById('chat-container');
            const chatContentWrapper = document.getElementById('chat-content-wrapper');
            const messageInput = document.getElementById('message-input');
            const chatForm = document.getElementById('chat-form');
            const scrollToBottomBtn = document.getElementById('scroll-to-bottom-btn');
            const profileForm = document.getElementById('profile-form');
            const sendButton = document.getElementById('send-button');
            const allModals = document.querySelectorAll('.modal-overlay');
            const suggestionCards = document.querySelectorAll('.suggestion-card');
            const sidebarFooterAuth = document.getElementById('sidebar-footer-auth');
            const sidebarFooterGuest = document.getElementById('sidebar-footer-guest');
            const loginSignupBtn = document.getElementById('login-signup-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const authModal = document.getElementById('auth-modal');
            const authModalTitle = document.getElementById('auth-modal-title');
            const authViewSwitches = document.querySelectorAll('.auth-view-switch');
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const forgotPasswordForm = document.getElementById('forgot-password-form');
            const authViews = document.querySelectorAll('.auth-view');
            const googleLoginBtns = document.querySelectorAll('.btn-google');
            const profileFullName = document.getElementById('full-name');
            const profileEmail = document.getElementById('email');

            // --- Message Templates ---
            const GUEST_INITIAL_MESSAGE = `<div class="chat-message ai-message"><div class="message-header"><div class="message-role">Model</div></div><div class="message-body"><p>Hello! I'm Gemini. Please log in or sign up to start a conversation.</p></div></div>`;
            const LOGGED_IN_WELCOME_MESSAGE = `<div class="chat-message ai-message"><div class="message-header"><div class="message-role">Model</div></div><div class="message-body"><p>Hello! I'm Gemini. Ask me anything, or try a suggestion to get started.</p></div></div>`;

            // --- Sidebar & Navigation ---
            const closeSidebar = () => body.classList.remove('left-sidebar-open');
            menuToggle.addEventListener('click', (e) => { e.stopPropagation(); body.classList.toggle('left-sidebar-open'); });
            overlay.addEventListener('click', closeSidebar);

            const showScreen = (screenId) => {
                const screenToShow = document.getElementById(screenId);
                if (!screenToShow) return;
                
                screens.forEach(screen => screen.classList.remove('active'));
                navLinks.forEach(link => link.classList.remove('active'));
                
                screenToShow.classList.add('active');
                
                const activeLink = document.querySelector(`.nav-link[data-screen="${screenId}"]`);
                if(activeLink) {
                    activeLink.classList.add('active');
                    const titleText = activeLink.querySelector('span:not(.material-symbols-outlined)').textContent.trim();
                    headerTitle.textContent = titleText;
                    contentArea.setAttribute('aria-label', `Main content: ${titleText} screen`);
                }

                if (screenId === 'chat-screen') messageInput.focus();
                if (window.innerWidth < 1024) closeSidebar();
            };

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => { 
                    e.preventDefault(); 
                    const screenId = link.getAttribute('data-screen');
                    if (screenId === 'chat-screen') {
                        startNewChat(); // Always start a new chat when this link is clicked
                    } else if (screenId) {
                        showScreen(screenId);
                    }
                });
            });
            
            // --- Chat Scroll & New Message Indicator ---
            chatContainer.addEventListener('scroll', () => {
                const threshold = 100;
                const isAtBottom = chatContainer.scrollHeight - chatContainer.scrollTop - chatContainer.clientHeight < threshold;
                isUserScrolledUp = !isAtBottom;
                scrollToBottomBtn.classList.toggle('visible', isUserScrolledUp);
            });
            scrollToBottomBtn.addEventListener('click', () => {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            });

            // --- Chat & Message Processing ---
            const showTypingIndicator = () => {
                const indicatorHtml = `<div class="typing-indicator" id="typing-indicator">Thinking <div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;
                if (!document.getElementById('typing-indicator')) {
                    chatContentWrapper.insertAdjacentHTML('beforeend', indicatorHtml);
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }
            }

            const removeTypingIndicator = () => {
                const indicator = document.getElementById('typing-indicator');
                if (indicator) indicator.remove();
            }
            
            const escapeHtml = (unsafe) => unsafe.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");

            const addMessageToChat = (htmlContent) => {
                removeTypingIndicator();
                chatContentWrapper.insertAdjacentHTML('beforeend', htmlContent);
                if (!isUserScrolledUp) {
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }
            }

            const clearChat = () => chatContentWrapper.innerHTML = '';

            const startNewChat = () => {
                clearChat();
                if(auth.currentUser) {
                    chat = model.startChat({ history: [] }); // Reset conversation history
                    addMessageToChat(LOGGED_IN_WELCOME_MESSAGE);
                } else {
                    addMessageToChat(GUEST_INITIAL_MESSAGE);
                }
                showScreen('chat-screen');
            }
            
            // --- Generic Modal Logic ---
            const openModal = (modalElement) => {
                if (!modalElement) return;
                lastActiveElement = document.activeElement;
                modalElement.classList.add('visible');
                const closeButton = modalElement.querySelector('.modal-close-btn');
                if (closeButton) closeButton.focus();
            };

            const closeModal = (modalElement) => {
                if (!modalElement) return;
                modalElement.classList.remove('visible');
                if (lastActiveElement) lastActiveElement.focus();
            };

            allModals.forEach(modal => {
                const closeBtn = modal.querySelector('.modal-close-btn');
                if(closeBtn) closeBtn.addEventListener('click', () => closeModal(modal));
                modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(modal); });
            });
            
            // --- Authentication State Change Handler ---
            auth.onAuthStateChanged(user => {
                const profileLink = document.querySelector('.nav-link[data-screen="profile-screen"]');
                clearChat();
                if (user) {
                    sidebarFooterAuth.style.display = 'block';
                    sidebarFooterGuest.style.display = 'none';
                    profileLink.style.pointerEvents = 'auto';
                    profileLink.style.opacity = '1';
                    profileFullName.value = user.displayName || '';
                    profileEmail.value = user.email || '';
                    startNewChat();
                } else {
                    sidebarFooterAuth.style.display = 'none';
                    sidebarFooterGuest.style.display = 'block';
                    if (document.querySelector('#profile-screen.active')) {
                        showScreen('home-screen');
                    }
                    profileLink.style.pointerEvents = 'none';
                    profileLink.style.opacity = '0.5';
                    addMessageToChat(GUEST_INITIAL_MESSAGE);
                }
            });

            loginSignupBtn.addEventListener('click', () => openModal(authModal));
            logoutBtn.addEventListener('click', () => auth.signOut().catch(error => alert(`Logout failed: ${error.message}`)));
            
            // --- Auth Modal View Switching ---
            const switchAuthView = (targetViewId) => {
                authViews.forEach(view => view.classList.remove('active'));
                const targetView = document.getElementById(targetViewId);
                if (targetView) {
                    targetView.classList.add('active');
                    if (targetViewId === 'login-view') authModalTitle.textContent = 'Login';
                    else if (targetViewId === 'signup-view') authModalTitle.textContent = 'Create Account';
                    else authModalTitle.textContent = 'Reset Password';
                }
            };

            authViewSwitches.forEach(link => link.addEventListener('click', (e) => { e.preventDefault(); switchAuthView(link.dataset.targetView); }));

            // --- Authentication Form Handlers ---
            loginForm.addEventListener('submit', (e) => { 
                e.preventDefault(); 
                auth.signInWithEmailAndPassword(loginForm['login-email'].value, loginForm['login-password'].value)
                    .then(() => closeModal(authModal))
                    .catch(error => alert(`Login failed: ${error.message}`));
            });

            signupForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = signupForm['signup-name'].value;
                const email = signupForm['signup-email'].value;
                const password = signupForm['signup-password'].value;
                auth.createUserWithEmailAndPassword(email, password)
                    .then(cred => cred.user.updateProfile({ displayName: name }))
                    .then(() => closeModal(authModal))
                    .catch(error => alert(`Sign-up failed: ${error.message}`));
            });

            forgotPasswordForm.addEventListener('submit', (e) => {
                e.preventDefault();
                auth.sendPasswordResetEmail(forgotPasswordForm['forgot-email'].value)
                    .then(() => { alert('Password reset link sent!'); switchAuthView('login-view'); })
                    .catch(error => alert(`Failed to send link: ${error.message}`));
            });
            
            googleLoginBtns.forEach(btn => btn.addEventListener('click', () => {
                auth.signInWithPopup(new firebase.auth.GoogleAuthProvider())
                    .then(() => closeModal(authModal))
                    .catch(error => alert(`Google Sign-in failed: ${error.message}`));
            }));

            // --- Global Escape Key for Modals ---
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    const visibleModal = document.querySelector('.modal-overlay.visible');
                    if (visibleModal) closeModal(visibleModal);
                }
            });

            // --- Main Chat Logic ---
            const autoResizeTextarea = () => {
                messageInput.style.height = 'auto';
                messageInput.style.height = `${Math.min(messageInput.scrollHeight, 200)}px`;
                sendButton.classList.toggle('active', messageInput.value.trim().length > 0);
            };
            messageInput.addEventListener('input', autoResizeTextarea);
            
            const handlePrompt = async (promptText) => {
                if (!auth.currentUser) {
                    alert("Please log in to start a chat.");
                    openModal(authModal);
                    return;
                }
                
                const sanitizedMessage = escapeHtml(promptText);
                const userMessageHtml = `<div class="chat-message user-message"><div class="message-header"><div class="message-role">User</div></div><div class="message-body"><p>${sanitizedMessage}</p></div></div>`;
                addMessageToChat(userMessageHtml);
                messageInput.value = '';
                autoResizeTextarea();
                
                showTypingIndicator();
                sendButton.disabled = true;

                try {
                    const result = await chat.sendMessage(promptText);
                    const response = await result.response;
                    const text = response.text();
                    const formattedText = markdownConverter.makeHtml(text);
                    const aiResponseHtml = `<div class="chat-message ai-message"><div class="message-header"><div class="message-role">Model</div></div><div class="message-body">${formattedText}</div></div>`;
                    addMessageToChat(aiResponseHtml);
                } catch (error) {
                    console.error("Gemini API Error:", error);
                    const errorMsg = `<div class="chat-message ai-message"><div class="message-header"><div class="message-role">Model</div></div><div class="message-body"><p>Sorry, an error occurred. Please check the console for details and try again.</p></div></div>`;
                    addMessageToChat(errorMsg);
                } finally {
                    sendButton.disabled = false;
                    messageInput.focus();
                    removeTypingIndicator();
                }
            };

            chatForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const messageText = messageInput.value.trim();
                if (messageText && !sendButton.disabled) {
                    handlePrompt(messageText);
                }
            });

            // --- Suggestion Cards Click Handler ---
            suggestionCards.forEach(card => {
                card.addEventListener('click', (e) => {
                    e.preventDefault();
                    const prompt = card.dataset.prompt;
                    if (prompt) {
                        startNewChat(); // Ensures it starts a fresh chat
                        setTimeout(() => handlePrompt(prompt), 50); // Small delay to allow screen transition
                    }
                });
            });

            // --- Profile Form Update Handler ---
            profileForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const user = auth.currentUser;
                if (user) {
                    const newName = profileFullName.value.trim();
                    if (newName !== user.displayName) {
                        user.updateProfile({ displayName: newName })
                            .then(() => alert('Profile updated successfully!'))
                            .catch(error => alert(`Profile update failed: ${error.message}`));
                    } else {
                        alert('No changes to save.');
                    }
                }
            });

            // --- Initial Application Setup ---
            autoResizeTextarea();
            showScreen('home-screen');
        });
    </script>
</body>
</html>
